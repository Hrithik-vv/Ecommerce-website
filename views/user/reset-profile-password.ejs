<%- include("../../views/partials/user/header") %>
<section class="content-main mt-80 mb-80">
    <div class="card mx-auto card-login" style="max-width: 500px;">
        <div class="card-body">
            <h4 class="card-title mb-4 text-center">Reset Password</h4>
            <form method="post" action="/profile/reset-password" onsubmit="return validateForm()">
                <div class="mb-3 position-relative">
                    <label for="currentPassword" class="form-label">Current Password</label>
                    <input class="form-control" name="currentPassword" id="currentPassword" 
                        placeholder="Enter your current password"
                        type="password" required style="border: 1px solid #ced4da;">
                    <div id="currentPasswordError" class="text-danger position-absolute" style="bottom: -20px; left: 0;"></div>
                </div>

                <div class="mb-3 position-relative">
                    <label for="newPassword" class="form-label">New Password</label>
                    <input class="form-control" name="newPassword" id="newPassword" 
                        placeholder="Enter new password"
                        type="password" required style="border: 1px solid #ced4da;">
                    <div id="newPasswordError" class="text-danger position-absolute" style="bottom: -20px; left: 0;"></div>
                    <div class="password-requirements mt-2 small text-muted">
                        Password must contain:
                        <ul>
                            <li>At least 8 characters</li>
                            <li>At least one uppercase letter</li>
                            <li>At least one lowercase letter</li>
                            <li>At least one number</li>
                            <li>At least one special character</li>
                        </ul>
                    </div>
                </div>

                <div class="mb-4 position-relative">
                    <label for="confirmPassword" class="form-label">Confirm New Password</label>
                    <input class="form-control" name="confirmPassword" id="confirmPassword" 
                        placeholder="Re-enter new password"
                        type="password" required style="border: 1px solid #ced4da;">
                    <div id="confirmPasswordError" class="text-danger position-absolute" style="bottom: -20px; left: 0;"></div>
                </div>

                <div class="mb-4 mt-5">
                    <button type="submit" class="btn btn-primary w-100">Reset Password</button>
                </div>
                <% if (locals.message && message.length > 0) { %>
                    <div id="alertMessage" class="alert alert-danger text-center">
                        <%= message %>
                    </div>
                <% } %>

                <% if (locals.successMessage && successMessage.length > 0) { %>
                    <div id="successMessage" class="alert alert-success text-center">
                        <%= successMessage %>
                    </div>
                <% } %>
            </form>
        </div>
    </div>
</section>

<%- include("../../views/partials/user/footer") %>

<script>
    function validateForm() {
        let valid = true;
        const currentPassword = document.getElementById('currentPassword');
        const newPassword = document.getElementById('newPassword');
        const confirmPassword = document.getElementById('confirmPassword');
        
        const currentPasswordError = document.getElementById('currentPasswordError');
        const newPasswordError = document.getElementById('newPasswordError');
        const confirmPasswordError = document.getElementById('confirmPasswordError');

        // Clear previous errors
        currentPasswordError.textContent = '';
        newPasswordError.textContent = '';
        confirmPasswordError.textContent = '';

        // Validate current password
        if (!currentPassword.value.trim()) {
            currentPasswordError.textContent = 'Current password is required';
            valid = false;
        }

        // Validate new password
        if (!newPassword.value.trim()) {
            newPasswordError.textContent = 'New password is required';
            valid = false;
        } else if (newPassword.value.length < 8) {
            newPasswordError.textContent = 'Password must be at least 8 characters long';
            valid = false;
        } else if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()]).{8,}/.test(newPassword.value)) {
            newPasswordError.textContent = 'Password must meet all requirements';
            valid = false;
        }

        // Validate confirm password
        if (!confirmPassword.value.trim()) {
            confirmPasswordError.textContent = 'Please confirm your password';
            valid = false;
        } else if (confirmPassword.value !== newPassword.value) {
            confirmPasswordError.textContent = 'Passwords do not match';
            valid = false;
        }

        // Check if new password is same as current password
        if (newPassword.value === currentPassword.value && newPassword.value !== '') {
            newPasswordError.textContent = 'New password cannot be the same as current password';
            valid = false;
        }

        return valid;
    }

    // Real-time validation for password strength
    document.getElementById('newPassword').addEventListener('input', function() {
        const value = this.value;
        const errorDiv = document.getElementById('newPasswordError');
        
        // Clear previous error
        errorDiv.textContent = '';
        
        if (value.length > 0) {
            let validations = {
                length: value.length >= 8,
                lowercase: /[a-z]/.test(value),
                uppercase: /[A-Z]/.test(value),
                number: /\d/.test(value),
                special: /[!@#$%^&*()]/.test(value)
            };
            
            // Check if any validation fails
            if (!validations.length || !validations.lowercase || !validations.uppercase || 
                !validations.number || !validations.special) {
                errorDiv.textContent = 'Password does not meet all requirements';
            }
        }
    });

    // Check password match in real-time
    document.getElementById('confirmPassword').addEventListener('input', function() {
        const newPassword = document.getElementById('newPassword').value;
        const errorDiv = document.getElementById('confirmPasswordError');
        
        if (this.value !== newPassword) {
            errorDiv.textContent = 'Passwords do not match';
        } else {
            errorDiv.textContent = '';
        }
    });
</script> 